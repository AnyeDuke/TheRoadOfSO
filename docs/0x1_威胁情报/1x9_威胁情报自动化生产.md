# 威胁情报自动化生产

本文从看到果胜师傅的“浅谈基于开源工具的威胁情报自动化生产”[1]一文开始思考和整理。



## 背景

“对于红队和渗透测试人员来说,获取更多的漏洞情报,将自己的基础设施和工具链条**隐藏在已知威胁情报之外**也是提高行动成功率的重要措施”[1]

"如果不能在本地**结合自身业务**对互联网威胁情报平台的海量数据进行提取,则威胁情报的对安全工作的指导意义会大幅下降。"[1]

攻防对抗的本质是成本的对抗，从这个角度来看，威胁情报的建设和应用，不外乎：威胁情报 +本地化（结合业务） + 自动化。



## 方法论

威胁情报的本地化生产（其实就是定制化的意思），主要包含：

- 获取与自身相关的IOC
    - e.g. hash, ip, url...
    - 来源于本地设备，OSINT，SRC等
- 逐步扩张IOC
    - 第一步是进行评估现有，基于痛苦金字塔模型
        - Pyramid of Pain 可以用来评估IOC价值，价值从到高
        - <img src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200619164927.png" style="zoom: 50%;" />
    - 第二步是使用人工或者自动分析系统（沙箱）分析原始IOC，从而产出更高价值的关联IoC指标
- 集成威胁情报
    - 集成就是讲数据标准化后进行存储和共享
    - 例如，MISO, STIX等多个威胁情报共享标准

以上内容全部来自果胜师傅的总结[1]



## 系统搭建

针对小型或起步的SoC来说，开源工具搭建+少量开发是非常好的方案。

### 开源工具选择

#### TreatIngestor

- 项目地址：https://github.com/InQuest/ThreatIngestor

- “ThreatIngestor是inquest实验室推出的一个威胁情报采集框架,该框架可以从社交媒体,消息队列,博客,自定义插件等渠道采集可用于威胁情报的IOC信息,并以编排剧本的方式灵活的配置采集和处理信息的具体步骤“[1]

#### TheHive

- 官网：https://thehive-project.org/
- 项目地址：https://github.com/TheHive-Project/TheHive

- 介绍：TheHive是一个可扩展的4合1开源和免费安全事件响应平台，旨在使SOC，CSIRT，CERT和任何需要迅速调查并采取行动的信息安全从业人员，更加轻松。



#### Cortex

- 项目地址：https://github.com/TheHive-Project/Cortex/

- TheHive的后台分析引擎，用于对IoC进行可视化、批量分析
- “cortex比主项目thehive具有更好的API SDK和文档支持,更加方便与第三方代码集成。”



### 搭建过程

#### 使用ElasticSearch

```bash
$ brew install elasticsearch
$ brew install kibana
```

笔者使用macOS可以直接用homebrew安全，es运行在后台9200端口，kibana提供es的一个可视化面板进行管理和应用

<img src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200621144623.png" style="zoom:50%;" />

Fig. ElasticSearch后台（9200端口）界面

![](https://image-host-toky.oss-cn-shanghai.aliyuncs.com/20200621144445.png)

Fig. Kibana面板界面（5601端口）





## References

[1] 浅谈基于开源工具的威胁情报自动化生产，果胜，https://paper.seebug.org/1210/

